<!DOCTYPE html>
<html lang="en">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<head>
	
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<script src="https://use.fontawesome.com/9f2531d167.js"></script>
	<script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
	<script src="js/index_js.js"></script>
	<script src="https://www.gstatic.com/firebasejs/4.8.0/firebase.js"></script>
	<script src="https://cdn.jsdelivr.net/momentjs/2.12.0/moment.min.js"></script>
	<script type="text/javascript" href="assets/jquery.simpleWeather.min.js"></script>
	<link rel="stylesheet" type="text/css" href="style/style.css">
	<title>WorkoutApp</title>
</head>
<body>
<nav>
  <img class= "logo" src= "assets/logo.png"/>
  <li class= "nameTag">the workout app</li>
  
  <div class= "fullmenu">
    <img class= "exit" src= "https://cdn4.iconfinder.com/data/icons/geomicons/32/672366-x-128.png"/>
    <ul>
	    <li class="home"><img src="assets/home-logo.png" class="navLogo"><a href="index.html"></a>
			<div class= "dropdown">
	          <ul>
	              <li><a href= '#'>SUB HEADING 1</a></li>
	              <li><a href= '#'>SUB HEADING 2</a></li>
	              <li><a href= '#'>SUB HEADING 3</a></li>
	          </ul>
	        </div>
	    </li>
	    <li class="home"><img src="assets/profile-logo.png" class="navLogo"><a href="#"></a></li>
	    <li class="home"><img src="assets/heart-logo.png" class="navLogo"><a href="#"></a></li>  
  </ul> 
  </div>
  <img class= "menu-icon" src= "http://citysmokehousesf.com/images/menu_icon.png"/>
</nav>
<div class="main">
<div class="main-content">

<div class="left">
	<div class="date">
		<div id="map"></div>

	</div>
	<div class="weather">
		<div id="weather"></div>
	</div>
	<div id="timer">
        <div id="display">00:00</div>
        <div id="buttons">
            <button id="start">Start</button>
            <button id="stop">Stop</button>
            <button id="reset">Reset</button>
            <button id="lap">Lap</button>
        </div>
        <div id="laps"></div>
    </div>
</div>


<div class="right">
<div class="progress">
	<div class="container">

	<br>

	
	<div class="jumbotron">
		<h1 class="text-center">My Workout Log</h1>
	</div>

	<div class="row">

		
		<div class="col-lg-12">
			<div class="panel panel-success">
				<div class="panel-heading">
					
				</div>
				<div class="panel-body">
				<table class="table">
					<tr>
						<th>Distance</th>
						<th>Duration</th>
						<th>Resistance</th>
						<th>Heart Rate</th>
						<th>Current Time</th>
					</tr>
				</table>	
				</div>
			</div>
		



	<div class="row">

		
		<div class="col-lg-12">
			<div class="panel panel-success">
				<div class="panel-heading">
					<h3 class="panel-title">Add WOD</h3>
				</div>
				<div class="panel-body">

					
					<form role="form">
						<div class="form-group">
							<label for="text">Distance:</label>
							<input type="text" class="form-control" id="name-input">
						</div>
						<div class="form-group">
							<label for="text">Duration:</label>
							<input type="email" class="form-control" id="destination-input">
						</div>
						<div class="form-group">
							<label for="text">Resistance:</label>
							<input type="text" class="form-control" id="time-input">
						</div>
						<div class="form-group">
							<label for="text">Heart Rate:</label>
							<input type="number" class="form-control" id="frequency-input">
						</div>

						<div class="paddingButton2">
						<button type="submit" class="btn btn-default" id="button submit"></button>
						</div>
				
					</form>

				</div>
			</div>
		</div>
</div>
	<div>
		<ul class="documentation">
			<ul class="bottom"><a class="docs" href="#">About Us ·</a></ul>
			<ul class="bottom"><a class="docs" href="#">Contact ·</a></ul>
			<ul class="bottom"><a class="docs" href="#">Jobs ·</a></ul>
			<ul class="bottom"><a class="docs" href="#">API ·</a></ul>
			<ul class="bottom"><a class="docs" href="#">Support</a></ul>
		</ul>
	</div>
	<span class="copyright">© 2017 WorkoutApp</span>
</div>
</div>
</div>
</div>


 <script type="text/javascript">
    // This is our API key
    
    // Here we run our AJAX call to the YahooWeather API
    
$("#submitBtn").on("click", function(){
  event.preventDefault();

  var city = $("#cityInput").val().trim();
  var state = $("#stateInput").val();
  var queryURL = "https://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20weather.forecast%20where%20woeid%20in%20(select%20woeid%20from%20geo.places(1)%20where%20text%3D%22"+city+"%2C%20"+state+"%22)&format=json&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys";
  
  $.ajax({
        url: queryURL,
        method: "GET"
      })
      .done(function(data) {
        $(".city").empty(); 
        $(".temp").empty();
        $(".maxMin").empty();
        $(".forecast").empty();
        $(".imageWeather").empty();

        var varCode = data.query.results.channel.item.forecast[0].code


        $(".city").append(data.query.results.channel.item);
        $(".temp").text("Temperature: " + data.query.results.channel.item.condition.temp + " (°F)");
        $(".maxMin").append("Max: " + data.query.results.channel.item.forecast[0].high + " Min: " + data.query.results.channel.item.forecast[0].low);
        $(".forecast").text("Forecast: " + data.query.results.channel.item.condition.text);
        $(".imageWeather").attr("src", "https://s.yimg.com/zz/combo?a/i/us/we/52/" + varCode + ".gif");
        
      });

})



var config = {
  
    apiKey: "AIzaSyCJKDCt6N_-PUTW2WUDoqlK8X6-0JHLwfE",
    authDomain: "workout-log-utcbc.firebaseapp.com",
    databaseURL: "https://workout-log-utcbc.firebaseio.com",
    projectId: "workout-log-utcbc",
    storageBucket: "workout-log-utcbc.appspot.com",
    messagingSenderId: "565408977376"
  };
  firebase.initializeApp(config);


  var database = firebase.database();

  // on click button
  	$("#submit").click(function(){
  		var name = $("#name-input").val().trim();
  		var destination = $("#destination-input").val().trim();
  		var time = $("#time-input").val().trim();
  		var frequency = $("#frequency-input").val().trim();

  		//pushing input into firebase
  		database.ref().push({
  			name: name,
  			destination: destination,
  			time: time,
  			frequency: frequency
  		})
	  		
	  		$("input").val('');
	  		return false;
}); 

  
  database.ref().on("child_added", function(childSnapshot){
  		// pull the data
  		var name = childSnapshot.val().name;
  		var destination = childSnapshot.val().destination;
  		var time = childSnapshot.val().time;
  		var frequency = childSnapshot.val().frequency;
	
			console.log("Name: " + name);
			console.log("Destination: " + destination);
			console.log("Time: " + time);
			console.log("Frequency: " + frequency);
			console.log(moment().format("hh:mm"));

		
		var firstTimeConverted = moment(time,"hh:mm").subtract(1, "years");
		console.log(firstTimeConverted);
		
		var currentTime = moment();
		console.log("CURRENT TIME: " + moment(currentTime).format("hh:mm"));
		
		var diffTime = moment().diff(moment(firstTimeConverted), "minutes");
		console.log("DIFFERENCE IN TIME: " + diffTime);
		
		var theRemainder = diffTime % frequency;
		console.log(theRemainder);
		
		var theMinutesTillTrain = frequency - theRemainder;
		console.log("MINUTES TILL TRAIN: " + theMinutesTillTrain);
		
		var nextTrain = moment().add(theMinutesTillTrain, "minutes").format("hh:mm");
		console.log("ARRIVAL TIME: " + moment(nextTrain).format("hh:mm"));	

	//display in the top table  
	var trainRow = $("<tr/>").attr("data-name", name);
	  trainRow.append($("<td/> ").text(name));
	  trainRow.append($("<td/> ").text(destination));
	  trainRow.append($("<td/> ").text(frequency));
	  trainRow.append($("<td/> ").text(nextTrain)); 
	  trainRow.append($("<td/> ").text(theMinutesTillTrain));
	  $(".table").append(trainRow);

});	


    window.onload = function() {
        $("#lap").click(stopwatch.recordLap);
        $("#stop").click(stopwatch.stop);
        $("#reset").click(stopwatch.reset);
        $("#start").click(stopwatch.start);


    };

    //  Variable that will hold our setInterval that runs the stopwatch
    var intervalId;

    //prevents the clock from being sped up unnecessarily
    var clockRunning = false;

    // Our stopwatch object
    var stopwatch = {

        time: 0,
        lap: 1,

        reset: function() {

            stopwatch.time = 0;
            stopwatch.lap = 1;

            // DONE: Change the "display" div to "00:00."
            $("#display").text("00:00");

            // DONE: Empty the "laps" div.
            $("#laps").text("");
        },
        start: function() {

            // DONE: Use setInterval to start the count here and set the clock to running.
            if (!clockRunning) {
                intervalId = setInterval(stopwatch.count, 1000);
                clockRunning = true;
            }
        },
        stop: function() {

            // DONE: Use clearInterval to stop the count here and set the clock to not be running.
            clearInterval(intervalId);
            clockRunning = false;
        },
        recordLap: function() {

            // DONE: Get the current time, pass that into the stopwatch.timeConverter function,
            //       and save the result in a variable.
            var converted = stopwatch.timeConverter(stopwatch.time);

            // DONE: Add the current lap and time to the "laps" div.
            $("#laps").append("<p>Lap " + stopwatch.lap + " : " + converted + "</p>");

            // DONE: Increment lap by 1. Remember, we can't use "this" here.
            stopwatch.lap++;
        },
        count: function() {

            // DONE: increment time by 1, remember we cant use "this" here.
            stopwatch.time++;

            // DONE: Get the current time, pass that into the stopwatch.timeConverter function,
            //       and save the result in a variable.
            var converted = stopwatch.timeConverter(stopwatch.time);
            console.log(converted);

            // DONE: Use the variable we just created to show the converted time in the "display" div.
            $("#display").text(converted);
        },
        timeConverter: function(t) {

            var minutes = Math.floor(t / 60);
            var seconds = t - (minutes * 60);

            if (seconds < 10) {
                seconds = "0" + seconds;
            }

            if (minutes === 0) {
                minutes = "00";
            } else if (minutes < 10) {
                minutes = "0" + minutes;
            }

            return minutes + ":" + seconds;
        }
    };





    if ("geolocation" in navigator) {
  $('.js-geolocation').show(); 
} else {
  $('.js-geolocation').hide();
}

/* Where in the world are you? */
$('.js-geolocation').on('click', function() {
  navigator.geolocation.getCurrentPosition(function(position) {
    loadWeather(position.coords.latitude+','+position.coords.longitude); //load weather using your lat/lng coordinates
  });
});

/* 
* Test Locations
* Austin lat/long: 30.2676,-97.74298
* Austin WOEID: 2357536
*/
$(document).ready(function() {
  loadWeather('Seattle',''); //@params location, woeid
});

function loadWeather(location, woeid) {
  $.simpleWeather({
    location: location,
    woeid: woeid,
    unit: 'f',
    success: function(weather) {
      html = '<h2><i class="icon-'+weather.code+'"></i> '+weather.temp+'&deg;'+weather.units.temp+'</h2>';
      html += '<ul><li>'+weather.city+', '+weather.region+'</li>';
      html += '<li class="currently">'+weather.currently+'</li>';
      html += '<li>'+weather.alt.temp+'&deg;C</li></ul>';  
      
      $("#weather").html(html);
    },
    error: function(error) {
      $("#weather").html('<p>'+error+'</p>');
    }
  });
}

</script>







</body>
</html>